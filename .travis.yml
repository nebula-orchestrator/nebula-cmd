language: python
dist: xenial
python:
- '3.7'
env:
  global:
  - GITHUB_PROJECT=nebula-cmd
  - secure: NhDoIISkLBzlUQyLaI+fH5oasxQS0GGebstF8rUOv1GpQf/lEkSWzI5A39UShcnx2c0lvaGzNtpl+JHHTJBZq2OM8G8+9rYe3fy8pEk48Fc6WA7OidmXJsikEpaP5gdV79oqM6/aDpCIRr9d2F8uUVPfRhd7mligmaPzrFR8a+qvhCWbgOnUB5fCp+e7jg3fv6LB3kE908i8Hwe8ZYBd0408AdcF+0lnMuh7lYRKWC+ZiEmeKi4jbZ58re7Ob5Ewgnj/KWVoaPP7krloNzxEN/inGY76rWx78irPgXmQvtZhY3NMirV8/ctAkqiGD9VnH9FHnEH+cCThPC791hgXZifZPlCxRarQ+t1ePX0m7hJ6k1sLttgBjoHDLPBaCofrEgHc9cDt4/sDlJRjpgGt1Ffa80Ub3kI0v3TBaQFih8qTAPAsBxEg9IVwXri+zp1VSCglX9dT2tXl7dOPXdfIHMVOpP/OGSAKcZEMoDEcJSJs6mjsm1AZqT6eZw0hZy65VM6iPQNWj29gj83/A1Gonxe58YLzHW0vLe2HawGbj6Y6W4lgnFUUMMoCf3VqLZR9yJ7FYEPy2hDT+lCrtpA5JNE08B6lGo+QdNca5UIEvwAxxXgiXPoxkvvXPCxER/tfVVQD1dyv0AYitRybefar2Hu1UjNFdR/i36j0Llf9UWw=
  - secure: ctc/N8zZlRVeU4+MAg6uhPoHYlxs4NNvRQbQn6UH/VBzQaZAJPl8vyGu2WTsM1R7P2eOPP4LDxLocLjfptUXtvCY5dZ2LS99JSx8xRdghHRIz9KdJqdqnFzf3rhl4O90edZM7GaPGj6oyArYdZDWDEh4pNUOzyAwF1ibOhIf4k4RFa96qfupE57HO5KDMIVo/r1GR4Xwr+Nq3/eTuFel5coiF5YpM6h277DebomnlJYsQTPOgpaIVrzM9l0RqVq3HsXEbRJycqWhM/FEoxUY6k+07FLB8hT3l38jVbktJG3WE18aGE2XTJxlsdBqAudfuBu6ZDJDxwFn9vZ8vpUTY3/RWQRVyRoccHEJInXK1bqHN9DQW5c/osc0F1POImhom3oJYtkt+y7fggFJQZdVOwBlQpvNNGXKkdiY2qpHXsd1p0Fp1ArvrMXu3vI1tEn8Rt3nZXNtS/X3Y1HpN6Tz3A3lGvdPXApCiDrXOweuZfc2V6+z9bHlP4EL1dH61doZG47b2AUi9YHEjbLp9Kel97autDhQRkHjywOjY38TpA/++tQ7pFFlZCZ52d+7zSHcZtnXwu70g49AfRYMpmaufHFweCgqCilPPD25wp/kTZ75vbOLdQweonPDLD3xCxFW4SgMX61/uO8JVBYWxyaEZhcu/glHL1/2wc8fpjdA7a4=
  - secure: bfjv89Qh8usE3gCdQbNgNCzPRRlEYMdJa2QOcl2nLEpg6YJgMNTxH89CS3KglhE5sGhVKQh2YWFyb1k5ggC/whJzqV9J3onq3+ykLAsFXFi6ouvLDu9mfi+E84h+9k2JNV3lEiDOHPBZ9VeUSgNCFwNBinB9aveQwzAoxGTxrjDBet1i+WOGWjJUFWoB9L+UgSz3nPHoSZ0dvLyoLTxDhFv0UmuPcs0gtZK524FEdGOaMrv08GK5JP21F2Ax6SiYJ0bOLP8S7AbcTiERat8tqJHPQ7zjZtnW/+mNT3QXc1CdJbrAgo1dIbVivns/7EwjBluKT81syNBsZmEhAuaLhJpe/GJLeG76/E0BaY8euCkwuOrnMYh/sDQIMEjFV/GHAbfuja5Le6ZeLbLqLVjNKUFEdZxy0Z+Zkma0BjWUdstzUbpah0NKKLJv6OP4rCkoGRx2+oFoYL8FwkIFC8b5fg2VmfSRnIvPbiu33Oj9gvICp1Y8ZTek3lwpa0RhiwoLVm8vnW0XSdYsGEs5tL2G/DDuyMeDVoPE83Y0QTMVZFUwAUljee+B5ORkqGv+AwJFSFlrC6+H/CXJ0VAPnIQDXVHZ3EpJJmtL7LF5RsagEVJNPkHAknd9zi6HZR89CrzUgczy1eOcbjpAnIkV6x4GIT+BOmkR8x3fh6fkyt74HU4=
  - secure: 2LqFFVKGssy06yFZh7LGZ5f1ji5R9QW7i65ldY+nXU5hvilLJrF6i2/19Z7wqChdQCHDEl1R87XLOcWd1xcCoXiR9XiR29LjTL+VsRbgHcIjQZPXr/UChb9HOB42wikS+YG/afETC10M7VKaZhoWR85W8SVe1f5IkL1kKZaf8zRQQfYccj2ZtEfUQLaLQ6Qc5xmavJY/bzOhWWSQf1FRvO3qqIex/vyAH1gZdZ35MRToDFkx6YdCuMErubZ4FVJ7VmCHzl3kf3N5tYXsSTR2Sbf/StpSDCu+hBnE/pNpdHk9RJNcwOdsXXi3PKo1Xmjl7NgKVoUR9tmX2M8ypMDEjEedx+7rXr9vVPm9ovhuKVA9Goh8z/2OKamPX6d6H2aoZNEhGjx7iwM/d2xaAbJQsSt7Jxnm5Lug29dN3EY7uXBSHbf5/7mEdbBnYwObTMpVtHi7nx3hcXGdJfRmXaVpqyCUvYbSW6XEgkRD7QJNVO3sQCi6Oj3R6qqBaI5n1rHUoJzt1jX6Fi76YQbrgnIlhbevTPXL8z+LuBUsWfZhbjR5H7aL0nXUHVzhX393fPyKGr3XdJpzHFBMEbT8lWiY7K/r9lFJhg23wp1xMKvli+1L3pMWqfXi026DjIzbXVdCGqBy2lSlZQiLqT8lEyQlhhH6pREV1z1W0CIIVD53RFM=
  - secure: E0FYVPYiKsE9D0b6APA1iY0Ki2AbkaqnToFGxzYHwxCiajm58FDhpKSd0voGvEJ/qubuhvX190EJExOBkeVHRHfsaIoUe6Ls2gBTwJYYMbv2T654AZV0MBoZYwz/36boY7t9KPRaECEkkM4D4WiIZhthVQureTYxNycxe+fE1oLH+W7fQemRpIUV40PfLcNvcK/ezGkJGwrdpLS3kBuuBBDNT48aLmgfMnet1N4N5QquMp8G4AxaQPY7198odq/qDsZxkOGOp4TRrwdLaSXKqc9Ge86rEDK/Ie42bOLISvcoTfzobUgPTX94RRBe9klN8LlATMqdaWPd2pFpk+AbLt13SshZr62Xw5sEJ4nhCmDoOhCzcJluB7be3zeqLCzybNxQl+nKR5qjUOqQ0fbX7+QLWzMXCxCxte7Dg8u6YTiBvuYTbmtMKxaSnizgLTPXzOrbesdIEPv0lxL6zv99LBeKdx0Nm1/6uOKNOwA5/YdpmgWVnDPXkGr/cfXAhUUFO7sPBsCaes+g0b372U9alysFPdSKO7uZsZqVZgN8Y+sCj8ReCTTOAytDBzkSQASq+7onWf97qobsxozqh348oAloxV/hNRnwOnTGrmlc5qjaD8tFR8o8//n+ovsE0itJ6BDkX7abzGKCUimuKER7HOsPaZEDwflwPGVeC4SpAeE=
  - secure: cl566cgLMolxYUmgrYAxGXsUNNXEzvGhx359ZC/r3+t2pLOyKRoTAqo378wpmVpBxE9AN+UNZss625mpXoq+R3XI7rCFk0uQZBBnbiCh6UxrVzm6mnwgK+fW+kJwPOWJS3tSG+9AHeW44II/5OFGIyuYsSLnq31zUBoDNtgxvgoOy3KUiii1BaQNzZnO09UF8MklKzLisXXf7JtXaOkbky40U7wn4PXxy8DWkEu5Td4BLjs6DWkRRoaCBsfbdM9Ubw4QsSM9Ke63jT3MgddaO4LWa2mX5e42aVX2se24IuyswKSFP5mCnpwJnp387Kj73sYMeBoMRNyZZOUHMOzfJz+nXjp0azHiMa3b0bJU+eNn0yZ4fqRTL6zEs9/tKdSA3rY4CgI+ZFCgaPnhlN+oapBPb+XcMjeIgLGhTX9Gs1LgID5060tzxW2tgTlTdBuWvTE98ESuP5SC0s3Ont7i8iCzfgB9gKYceemPqpB+HRRbhhn39P8FQ8xH9hKt0w8AR6JoARSjJ1zGyh4+SPcuF7wMZma0FkhhgtiDEqu+OMF4Ezq/dIOz1s3DQ/RUu0GIvfFr7Tcs5zf0kSUV/xC15481c8p+1yRl8KsZ59ECxRAOcQWJf6tM5YI2ieX/cR0CVbHtc0/9bZBRuzPtoYqw5l0/l5j32c7h/7u08Ad/frA=
  - secure: pZK5/jIRtTjGkqNKHGznWO+2iFOMgJpj2EApifpg7PQN4Knesq96gWzDwhfVeXIlftnr+/7+tKaJYmMISMCS+jsZwmhBxS4kYnNGV1jNqK6cQ6ANefCtdgKSLMNEPXpiLyXYD9BlBTd+46LAfVm05MFqCycr/BoI9JAUo0WoN224yiAKgrJLBu++bT9gXknClEGk+JAYP0NcsfsyuhSKsW4R5fmegOcG747BKEWceJy+uBU8LGmXKFn0Uz6H0emq85Dm+vSv44F2zW5dB60yqlEn5W49bpD5+/zYHJlVoF3DHaAU9XU2dAMknqseDr5X1fk9xFNztVsWsHFzNQi0oM8DsDcFedFnGFa7gUddSByyxYnjkoWHgkJWx9ofiFnPY2yipXFxj6Nd3X87aTUPUgfsaogEEkVNrw3+/X7EMzYL36Rf9jHrIhUzRicq0v4Ht/bEcoivTOyG2+xtzM7EPsT233RYDKiB6opgOKPbrfeQOogaijx2EF+CpaD3iXamLNPUnWBDhnwFBBUoCYoXPtkduJvcln1AJpYR8csjxDil+QuZMs3eduUPzk03sTxA5OlSktD0Kn4i1aBAStLEXZgnSVt/8uq2wcLE13qszjaS+uWS8qZeMPY6OCJ9tiWU1aMSsnKv2d61lq42fjrl4tOZ1g7HdG4THJOoE7mwJBg=
install:
- pip install -r requirements.txt
- pip install codecov
- pip install -U setuptools
script:
- sudo sh test/travis_ci_scripts/travis_ci_build_script.sh
- coverage run -m unittest
after_success:
- chmod +x test/travis_ci_scripts/upload_nebulactl.sh
- test/travis_ci_scripts/upload_nebulactl.sh
- codecov
- git config credential.helper "store --file=.git/credentials"
- echo "https://${GH_TOKEN}:@github.com" > .git/credentials
- git config --local user.name "${GITHUB_USER}"
- git config --local user.email "${GITHUB_USER_EMAIL}"
- git pull
- git commit -m '[skip travis] build ${TRAVIS_BUILD_NUMBER} pushed - new ${GITHUB_PROJECT} version released'
- git tag $(dist/nebulactl --version | awk -F"version" '{print $2}')
- git push origin $(dist/nebulactl --version | awk -F"version" '{print $2}')
- docker run -e GITHUB_USER=nebula-orchestrator -e GITHUB_PROJECT=${GITHUB_PROJECT} -e CHANGELOG_GITHUB_TOKEN=${GH_TOKEN} -v `pwd`:/output naorlivne/github-changelog-generator-dockerized
- git add CHANGELOG.md
- git commit -m '[skip travis] build ${TRAVIS_BUILD_NUMBER} pushed - new version changelog'
- git push origin HEAD:master